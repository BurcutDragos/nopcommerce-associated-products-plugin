@model AdminAssociatedProductsModel

<nop-card asp-name="plugin-associated-products"
          asp-icon="fas fa-link"
          asp-title="@T("Plugins.Widgets.AssociatedProducts.AdminCard.Title")"
          asp-hide-block-attribute-name="ProductPage.HideAssociatedProductsBlock"
          asp-hide="false"
          asp-advanced="false">
    <div class="card-body">
        <p>
            @T("Plugins.Widgets.AssociatedProducts.AdminCard.Hint")
        </p>

        @if (Model.ProductId > 0)
        {
            <div class="card card-default">
                <div class="card-body">
                    @await Html.PartialAsync("Table", new DataTablesModel
                    {
                        Name = "associated-products-grid",
                        UrlRead = new DataUrl("AssociatedProductList", "AssociatedProducts",
                            new RouteValueDictionary
                            {
                                [nameof(AssociatedProductSearchModel.ProductId)] =
                                    Model.AssociatedProductSearchModel.ProductId
                            }),
                        UrlDelete = new DataUrl("AssociatedProductDelete", "AssociatedProducts", null),
                        UrlUpdate = new DataUrl("AssociatedProductUpdate", "AssociatedProducts", null),
                        Length = Model.AssociatedProductSearchModel.PageSize,
                        LengthMenu = Model.AssociatedProductSearchModel.AvailablePageSizes,
                        ColumnCollection = new List<ColumnProperty>
                        {
                            new ColumnProperty(nameof(AssociatedProductModel.AssociatedProductName))
                            {
                                Title = T("Plugins.Widgets.AssociatedProducts.Fields.Product").Text
                            },
                            new ColumnProperty(nameof(AssociatedProductModel.DisplayOrder))
                            {
                                Title = T("Plugins.Widgets.AssociatedProducts.Fields.DisplayOrder").Text,
                                Width = "150",
                                ClassName = NopColumnClassDefaults.CenterAll,
                                Editable = true,
                                EditType = EditType.Number
                            },
                            new ColumnProperty(nameof(AssociatedProductModel.AssociatedProductId))
                            {
                                Title = T("Admin.Common.View").Text,
                                Width = "150",
                                ClassName = NopColumnClassDefaults.Button,
                                Render = new RenderButtonView(
                                    new DataUrl("~/Admin/Product/Edit/",
                                        nameof(AssociatedProductModel.AssociatedProductId)))
                            },
                            new ColumnProperty(nameof(AssociatedProductModel.Id))
                            {
                                Title = T("Admin.Common.Edit").Text,
                                Width = "200",
                                ClassName = NopColumnClassDefaults.Button,
                                Render = new RenderButtonsInlineEdit()
                            },
                            new ColumnProperty(nameof(AssociatedProductModel.Id))
                            {
                                Title = T("Admin.Common.Delete").Text,
                                Width = "100",
                                Render = new RenderButtonRemove(T("Admin.Common.Delete").Text),
                                ClassName = NopColumnClassDefaults.Button
                            }
                        }
                    })
                </div>
                <div class="card-footer">
                    <button type="button"
                            id="btnAddAssociatedProduct"
                            class="btn btn-primary"
                            onclick="javascript:OpenWindow('@(Url.Action("AssociatedProductAddPopup", "AssociatedProducts",
                                        new { productId = Model.ProductId,
                                              btnId = "btnRefreshAssociatedProducts",
                                              formId = "product-form" }))', 800, 800, true); return false;">
                        @T("Plugins.Widgets.AssociatedProducts.AdminCard.AddNew")
                    </button>
                    <button type="submit" id="btnRefreshAssociatedProducts" style="display: none"></button>
                    <script>
                        $(function () {
                            $('#btnRefreshAssociatedProducts').click(function () {
                                updateTable('#associated-products-grid');
                                return false;
                            });
                        });
                    </script>
                </div>
            </div>
        }
        else
        {
            <div class="card card-default">
                <div class="card-body">
                    @T("Plugins.Widgets.AssociatedProducts.AdminCard.SaveBeforeEdit")
                </div>
            </div>
        }
    </div>
</nop-card>
